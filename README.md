# func_invoke.hpp

`func_invoke.hpp` ‚Äî —ç—Ç–æ –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è C++ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è **–≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**, —Ç–∞–∫–∏—Ö –∫–∞–∫ JSON-–æ–±—ä–µ–∫—Ç—ã, –∫–∞—Ä—Ç—ã –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –≥–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∫–ª—é—á—É (–∏–º–µ–Ω–∏). –û–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ –≤—ã–∑—ã–≤–∞–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–∞—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

  * **–ì–∏–±–∫–∏–π –º–µ—Ö–∞–Ω–∏–∑–º –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π**: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, JSON). –í—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ, –∫–∞–∫ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ *–≤–∞—à–µ–≥–æ* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Ä–µ–∞–ª–∏–∑—É—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é **`func_invoke::extract_value`** –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Ü–µ–ª–µ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
  * **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤**: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
  * **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤**: –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ã—á–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏, —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏, `std::function`, –ª—è–º–±–¥–∞-–≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –º–µ—Ç–æ–¥–∞–º–∏ –∫–ª–∞—Å—Å–æ–≤.
  * **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –æ—à–∏–±–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.
  * **–£–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥, –∏–∑–±–∞–≤–ª—è—è –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç.
  * **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏**: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–∞** –∏–ª–∏ **–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤**.

-----

## ‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –æ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `func_invoke.hpp` **–Ω–µ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –≤ –æ–±—ä–µ–∫—Ç—ã**. –û–Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ **–ø–æ–≤–µ—Ä—Ö –≥–æ—Ç–æ–≤—ã—Ö –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤**. –ï—ë –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å —É–¥–æ–±–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–ø–æ—Å–æ–±—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å `func_invoke`, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é **`func_invoke::extract_value`**. –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –≥–¥–µ –≤—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª—é—á—É –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Ç—Ä–µ–±—É–µ–º—ã–π —Ç–∏–ø.

-----

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏

  * C++17 –∏–ª–∏ –Ω–æ–≤–µ–µ (–¥–ª—è `std::apply`, `std::make_index_sequence`, `std::string_view` –∏ —Ç.–¥.).
  * –í–∞—à –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª `func_invoke.hpp`.

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ü—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∏—Ç–µ `func_invoke.hpp` –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç. –≠—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø–æ—ç—Ç–æ–º—É –∫–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

```cpp
#include "func_invoke.hpp"
```

-----

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü—Ä–µ–∂–¥–µ —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ `invoke`, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è **`func_invoke::extract_value`**, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `func_invoke::extract_value`

–í–∞–º –Ω—É–∂–Ω–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å `func_invoke::extract_value` –¥–ª—è —Ç–∏–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–≤–ª–µ–∫–∞—Ç—å, –∏ –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–±—ä—è–≤–∏—Ç–µ **–æ–¥–Ω—É –æ–±—â—É—é —à–∞–±–ª–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é** `extract_value` –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –∏–º—ë–Ω `func_invoke` –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –í–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–∞—à–µ–º—É –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—É, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç ADL (Argument-Dependent Lookup) –Ω–∞–π—Ç–∏ —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏ –≤–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –≤–∞—à –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä —É–∂–µ –∏–º–µ–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.

–ü—Ä–∏–º–µ—Ä –¥–ª—è `boost::json::value` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫:

```cpp
#include <boost/json.hpp>
#include <string_view>
#include <typeinfo>

namespace func_invoke {
    template<typename T>
    static T extract_value(value_extractor_tag<T>, const boost::json::value& jv, std::string_view key) {
        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª—é—á–∞
        if (!jv.is_object() || !jv.as_object().contains(key.data())) {
            throw key_not_found_error(key); // –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ "–∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω"
        }

        const boost::json::value& value_from_json = jv.at(key.data());

        // 2. –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–∞ —Å –æ—Ç–ª–æ–≤–æ–º boost::json::error
        try {
            return boost::json::value_to<T>(value_from_json);
        }
        catch (const std::exception& ex) {
            // boost::json::value_to –º–æ–∂–µ—Ç –±—Ä–æ—Å–∞—Ç—å system_error –∏–ª–∏ –¥—Ä—É–≥–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ —Ç–∏–ø–æ–≤
            throw type_mismatch_error(key, typeid(T).name()); // –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ "–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞"
        }
    }
} // namespace func_invoke
```

–≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `func_invoke` –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞—à –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `boost::json::value_to`) —Å–ø–æ—Å–æ–±–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –≤–∫–ª—é—á–∞—è –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã (`int`, `double`, `std::string`) –∏ –≤–∞—à–∏ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã**, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `tag_invoke` –¥–ª—è Boost.JSON). –í–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π `key_not_found_error` –∏ `type_mismatch_error` –¥–µ–ª–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º.

-----

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ç–∏–ø–æ–º –∏ `boost::json`

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã `boost::json::value_to` –º–æ–≥ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–∏–ø, –≤–∞–º –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `tag_invoke` –¥–ª—è –Ω–µ–≥–æ:

```cpp
#include <iostream>
#include <boost/json.hpp>
#include "func_invoke.hpp"

namespace js = boost::json;

namespace test {
    // –ü—Ä–∏–º–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–∏–ø–∞
    struct MyCustomType {
        int value;
        std::string name;
    };

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ tag_invoke –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ boost::json::value –≤ MyCustomType
    // –≠—Ç–æ —á–∞—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ boost::json
    static MyCustomType tag_invoke(js::value_to_tag<MyCustomType>, const js::value& jv) {
        const js::object& obj_json = jv.as_object();
        // –ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è Boost.JSON, –µ—Å–ª–∏ –∫–ª—é—á–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ —Ç–∏–ø—ã –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
        return { js::value_to<int>(obj_json.at("value1")), js::value_to<std::string>(obj_json.at("name")) };
    }
} // namespace test

// –í–ê–ñ–ù–û: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è func_invoke::extract_value –¥–ª—è boost::json::value (—Å–º. –≤—ã—à–µ)
// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç tag_invoke –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤.
// ... (–≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ extract_value –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞)

static void process_custom_type(test::MyCustomType data) {
    std::cout << "MyCustomType -> value: " << data.value << ", name: " << data.name << "\n";
}

int main() {
    js::value j5 = {
        {"my_data", {{"value1", 100}, {"name", "Custom Data"}}}
    };
    js::value j6_missing_key = {
        {"my_data", {{"value1", 100}}} // –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª—é—á "name"
    };
    js::value j7_type_mismatch = {
        {"my_data", {{"value1", "not_an_int"}, {"name", "Custom Data"}}} // –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞ –¥–ª—è "value1"
    };
    js::value j8_wrong_root_key = {
        {"wrong_key", {{"value1", 100}, {"name", "Custom Data"}}} // –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ—Ä–Ω–µ–≤–æ–π –∫–ª—é—á
    };

    // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Ç–∏–ø–æ–º (—É—Å–ø–µ—à–Ω—ã–π —Å–ª—É—á–∞–π)
    std::cout << "--- –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ ---\n";
    try {
        func_invoke::invoke(j5, process_custom_type, { "my_data" }); // –í—ã–≤–µ–¥–µ—Ç: MyCustomType -> value: 100, name: Custom Data
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª—é—á (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è tag_invoke Boost.JSON)
    std::cout << "--- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª—é—á (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Boost.JSON) ---\n";
    try {
        func_invoke::invoke(j6_missing_key, process_custom_type, { "my_data" });
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞ –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Boost.JSON)
    std::cout << "--- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞ –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è Boost.JSON) ---\n";
    try {
        func_invoke::invoke(j7_type_mismatch, process_custom_type, { "my_data" });
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –ö–æ—Ä–Ω–µ–≤–æ–π –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è func_invoke::extract_value)
    std::cout << "--- –ö–æ—Ä–Ω–µ–≤–æ–π –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è func_invoke) ---\n";
    try {
        func_invoke::invoke(j8_wrong_root_key, process_custom_type, { "my_data" });
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl; // –í—ã–≤–µ–¥–µ—Ç: Key not found: my_data
    }
    std::cout << "\n";

    return 0;
}
```

-----

### –í—ã–∑–æ–≤ –æ–±—ã—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **`func_invoke::invoke`** –¥–ª—è –≤—ã–∑–æ–≤–∞ –æ–±—ã—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –ª—è–º–±–¥–∞-–≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏–ª–∏ `std::function`. –ö–æ–≥–¥–∞ –≤—ã –ø–µ—Ä–µ–¥–∞—ë—Ç–µ –∏–º—è –æ–±—ã—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –æ–Ω–æ **–Ω–µ—è–≤–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é**.

```cpp
#include "func_invoke.hpp"
#include <iostream>
#include <boost/json.hpp> 



namespace js = boost::json;

// –í–ê–ñ–ù–û: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è func_invoke::extract_value –¥–ª—è boost::json::value (—Å–º. –≤—ã—à–µ)
// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç tag_invoke –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤.
// ... (–≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ extract_value –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞)

void funcA(int id, double val, const std::string& name) {
    std::cout << "funcA -> id: " << id << ", val: " << val << ", name: " << name << "\n";
}

int main() {
    js::value j1 = { {"id", 42}, {"val", 3.14}, {"name", "Bob"} };
    js::value j1_missing_id = { {"val", 3.14}, {"name", "Bob"} };
    js::value j1_type_mismatch_val = { {"id", 42}, {"val", "three point one four"}, {"name", "Bob"} };

    const std::string_view keys_funcA[] = { "id", "val", "name" };

    // –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤
    std::cout << "--- –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ funcA ---\n";
    try {
        func_invoke::invoke(j1, funcA, keys_funcA); // –í—ã–≤–µ–¥–µ—Ç: funcA -> id: 42, val: 3.14, name: Bob
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –ö–ª—é—á 'id' –Ω–µ –Ω–∞–π–¥–µ–Ω
    std::cout << "--- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª—é—á 'id' ---\n";
    try {
        func_invoke::invoke(j1_missing_id, funcA, keys_funcA);
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl; // –í—ã–≤–µ–¥–µ—Ç: Key not found: id
    }
    std::cout << "\n";

    // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞ –¥–ª—è 'val'
    std::cout << "--- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∞ –¥–ª—è 'val' ---\n";
    try {
        func_invoke::invoke(j1_type_mismatch_val, funcA, keys_funcA);
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl; // –í—ã–≤–µ–¥–µ—Ç: Type mismatch for key 'val'. Expected type: double (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
    }
    std::cout << "\n";


    auto lambda = [](int a, float b) {
        std::cout << "lambda -> a: " << a << ", b: " << b << "\n";
    };
    js::value j2 = { {"a", 10}, {"b", 2.5} };
    const std::string_view keys_lambda[] = { "a", "b" };
    
    // –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ –ª—è–º–±–¥—ã
    std::cout << "--- –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ –ª—è–º–±–¥—ã ---\n";
    try {
        func_invoke::invoke(j2, lambda, keys_lambda); // –í—ã–≤–µ–¥–µ—Ç: lambda -> a: 10, b: 2.5
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    std::function<void(std::string)> f = [](std::string msg) {
        std::cout << "std::function -> " << msg << "\n";
    };
    js::value j3 = { {"msg", "hi from std::function"} };
    const std::string_view keys_f[] = { "msg" };

    // –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ std::function
    std::cout << "--- –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ std::function ---\n";
    try {
        func_invoke::invoke(j3, f, keys_f); // –í—ã–≤–µ–¥–µ—Ç: std::function -> hi from std::function
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    return 0;
}
```

-----

### –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–∞

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`func_invoke::invoke`** –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–∞.

```cpp
#include "func_invoke.hpp"
#include <iostream>
#include <boost/json.hpp> 


namespace js = boost::json;

// –í–ê–ñ–ù–û: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è func_invoke::extract_value –¥–ª—è boost::json::value (—Å–º. –≤—ã—à–µ)
// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç tag_invoke –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤.
// ... (–≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ extract_value –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞)

class Handler {
public:
    void greet(const std::string& name) const {
        std::cout << "Hello, " << name << "!\n";
    }
};

int main() {
    Handler h;
    js::value j4 = { {"name", "Alice"} };
    js::value j4_missing_name = { {"age", 30} };

    const std::string_view keys_greet[] = { "name" };

    // –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞
    std::cout << "--- –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ ---\n";
    try {
        func_invoke::invoke(j4, &Handler::greet, h, keys_greet); // –í—ã–≤–µ–¥–µ—Ç: Hello, Alice!
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl;
    }
    std::cout << "\n";

    // –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –ö–ª—é—á 'name' –Ω–µ –Ω–∞–π–¥–µ–Ω
    std::cout << "--- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–ª—é—á 'name' –¥–ª—è –º–µ—Ç–æ–¥–∞ ---\n";
    try {
        func_invoke::invoke(j4_missing_name, &Handler::greet, h, keys_greet);
    } catch (const std::exception& ex) {
        std::cerr << "–û—à–∏–±–∫–∞: " << ex.what() << std::endl; // –í—ã–≤–µ–¥–µ—Ç: Key not found: name
    }
    std::cout << "\n";

    return 0;
}
```

-----

## üí° –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∞–±–ª–æ–Ω—ã C++ –∏ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è:

1.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏**: `detail::FunctionTraits` –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–∏–ø—ã –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `std::tuple`.
2.  **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–æ—Ä—Ç–µ–∂–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤**: `detail::build_arg_tuple` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é **`func_invoke::extract_value`** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `std::tuple` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏.
3.  **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ—Ä—Ç–µ–∂–∞**: `std::apply` (C++17) –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–æ—Ä—Ç–µ–∂–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤ —Ü–µ–ª–µ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏–ª–∏ –º–µ—Ç–æ–¥.

-----

## ü§ù –í–∫–ª–∞–¥

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è –ª—é–±—ã–µ –≤–∫–ª–∞–¥—ã, —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ issue –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ pull request.

-----

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. —Ñ–∞–π–ª `LICENSE`.